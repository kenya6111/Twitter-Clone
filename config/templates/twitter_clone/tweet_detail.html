{% extends 'base.html' %}
{% load static %}
{% load sass_tags %}
{% load cloudinary %}

{% block title %}アカウント作成{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% sass_src 'css/main.scss' %}" />
<style>
    .w-7{
    width:7%;
    }
</style>
{% endblock %}

{% block content %}
{% if messages %}
{% for message in messages %}
    <div class="alert alert-success" role="alert">{{ message }}
    </div>
{% endfor %}
{% endif %}
<div class="w-100 h-100 bg-top-parent">
    <!-- ヘッダー -->
        {% include 'components/header.html' %}
    <!-- メインコンテンツ -->
    <div class="row menu-container">
        {% include 'components/sidebar.html' %}
        <!-- サイドバー -->
        <!-- センターバー -->
        <div class="col-4 border-gray-side">
            <!-- ツイート ＋ 戻るボタン -->
            <div class="fs-5 d-flex justify-content-start align-items-start pt-3 ps-3 ">
              <a href="{% url 'main' %}">
                  <i class="bi-arrow-left"></i>
              </a>
              <p class="ms-3 text-white">
                  ツイート
              </p>
          </div>

          <!-- ツイート詳細エリア -->
          <div class="d-flex flex-row pt-2 border-gray-bottom tweet">

            <div class="w-7 d-flex justify-content-center align-items-start mt-1 mx-3">
                <span onClick="moveToProfile('{% url 'profile' %}?user_id={{article.user.id}}',event)">
                    {% cloudinary article.user.image.name class="rounded-circle w-100 h-100" %}
                </span>
            </div>
            <div class="w-90 h-75 pe-4">
                <div class="w-100 text-white fs-6 fw-bold">
                    <p>{{ article.user.username}}</p>
                </div>
                <div class="text-white fs-5 ">
                    <p class="" style="overflow-wrap: break-word;">{{article.sentense}}</p>
                </div>
                {% if article.image %}
                <div>
                    {% cloudinary article.image.name width=300 height=300 %}
                </div>
                {% endif %}
                <div class="color-gray fs-6 d-flex justify-content-between py-2">
                    <i class="bi-chat"></i>
                    {% if article.id in retweet_article_ids %}
                        <i class="bi-arrow-repeat" style="color:green;" onclick="disRetweet(event, {{ article.id }}, 'main',{{login_user.id}}, null )">{{article.retweets__count}}</i>
                    {% else %}
                        <i class="bi-arrow-repeat" onclick="retweet(event, {{ article.id }}, 'main',{{login_user.id}}, null )">{{article.retweets__count}}</i>
                    {% endif %}

                    {% if article.id in liked_article_ids %}
                    <i class="bi-heart" style="color:red;" onclick="disLike(event, {{ article.id }}, 'tweet_detail',{{login_user.id}}, {{article.id}} )"><span class="ms-1">{{article.likes__count}}</i>
                    {% else %}
                        <i class="bi-heart" onclick="like(event,{{article.id}},'tweet_detail',{{login_user.id}}, {{article.id}})"><span class="ms-1">{{article.likes__count}}</i>
                    {% endif %}
                    <i class="bi-bar-chart"></i>
                    <i class="bi-bookmark"></i>
                    <i class="bi-arrow-bar-up"></i>
                </div>
            </div>
            <div class="icons">
            </div>
          </div>
          <!-- 返信フォームエリア -->
          <form action="{% url 'tweet_detail' %}" method="POST" class="h-10 d-flex flex-row border-gray-bottom" enctype="multipart/form-data"> {% csrf_token %}
            <div class="w-7 d-flex justify-content-center align-items-start mt-1 mx-3">
                <a href="{% url 'profile' %}?user_id={{login_user.id}}">
                    {% cloudinary login_user.image.name class="rounded-circle w-100 h-100" %}
                </a>
            </div>
            <div class="w-90 h-75 pe-4">
                <div class="w-100 h-75 border-gray-bottom">
                    <textarea type="textarea" id="post-area" name="tweet-sentence" class="w-100 h-75 fs-5 bg-black border border-black text-white" placeholder="返信をツイート" maxlength="140"></textarea>
                </div>
                <div class="d-flex justify-content-between my-2">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-geo-alt text-primary fs-5 me-3"></i>
                        <i class="bi bi-calendar text-primary fs-5 me-3"></i>
                        <i class="bi bi-emoji-smile text-primary fs-5 me-3"></i>
                        <i class="bi bi-filetype-gif text-primary fs-5 me-3"></i>
                        <label for="file-upload-tweet-image" class="" style="cursor: pointer;">
                            <i class="bi bi-image text-primary fs-5 me-3"></i>
                        </label>
                        <input type="file" id="file-upload-tweet-image" name="tweet-image" class="d-none">
                        <input type="text" id="user_id" name="user_id" class="d-none" value={{ login_user.id}}>
                    </div>
                    <div class="w-20">
                        <button type="submit" class="btn btn-light rounded-5 fw-bold  fs-6 w-100 btn-lg d-flex align-items-center justify-content-center" tabindex="-1" role="button" aria-disabled="true">
                            Post
                        </button>
                    </div>
                </div>
            </div>
            <input type="hidden" name="tweet_id" value={{article.id}}>
           </form>
        <!-- リプライリストエリア -->
        {% for reply in replies %}
        <a href="{% url 'tweet_detail' %}?tweet_id={{reply.reply_tweet.id}}">
            <div class="d-flex flex-row pt-2 border-gray-bottom tweet">

                <div class="w-7 d-flex justify-content-center align-items-start mt-1 mx-3">
                    <span onClick="moveToProfile('{% url 'profile' %}?user_id={{reply.reply_tweet.user.id}}',event)">
                        {% cloudinary reply.reply_tweet.user.image.name class="rounded-circle w-100 h-100" %}
                    </span>
                </div>
                <div class="w-90 h-75 pe-4">
                    <div class="w-100 text-white fs-6 fw-bold">
                        <p>{{ reply.reply_tweet.user.username}}</p>
                    </div>
                    <div class="text-white fs-5 ">
                        <p class="" style="overflow-wrap: break-word;">{{reply.reply_tweet.sentense}}</p>
                    </div>
                    {% if reply.reply_tweet.image %}
                    <div>
                        {% cloudinary reply.reply_tweet.image.name width=300 height=300 %}
                    </div>
                    {% endif %}
                    <div class="color-gray fs-6 d-flex justify-content-between py-2">
                        <i class="bi-chat"></i>
                        {% if article.id in retweet_article_ids %}
                            <i class="bi-arrow-repeat" style="color:green;" onclick="retweet(event, {{ article.id }}, 'main',{{login_user.id}}, null )">{{reply.retweet_count}}</i>
                        {% else %}
                            <i class="bi-arrow-repeat" onclick="retweet(event, {{ article.id }}, 'main',{{login_user.id}}, null )">{{reply.retweet_count}}</i>
                        {% endif %}

                        {% if reply.reply_tweet.id in liked_article_ids %}
                            <span onclick="disLike(event, {{ reply.reply_tweet.id }}, 'tweet_detail',{{login_user.id}}, {{article.id}} )">
                                <i class="bi-heart" style="color:red;"><span class="ms-1">{{reply.like_count}}</span></i>
                            </span>
                        {% else %}
                        <span onclick="like(event,{{reply.reply_tweet.id}},'tweet_detail',{{login_user.id}}, {{article.id}})">
                            <i class="bi-heart"><span class="ms-1">{{reply.like_count}}</span></i>
                        </span>
                        {% endif %}
                        <i class="bi-bar-chart"></i>
                        <i class="bi-bookmark"></i>
                        <i class="bi-arrow-bar-up"></i>
                    </div>
                </div>
                <div class="icons">
                </div>
            </div>
            </a>
            {% endfor %}


            <nav aria-label="..." class="mt-3">
                <ul class="pagination d-flex justify-content-center">
                    {% if replies.has_previous %}
                        <li class="page-item">
                            <!-- 前のページへのリンク -->
                            <a href="?p={{ replies.previous_page_number }}&&tweet_id={{article.id}}" class="page-link">前へ</a>
                        </li>
                    {% endif %}

                    {% for reply.tweet in replies.paginator.page_range %}
                        <li class="page-item">
                            <a class="page-link" href="?p={{ forloop.counter }}&&tweet_id={{article.id}}">{{forloop.counter}}</a>
                        </li>
                    {% endfor %}

                    <!-- 次のページへのリンク -->
                    {% if replies.has_next %}
                        <li class="page-item">
                            <a href="?p={{ replies.next_page_number }}&&tweet_id={{article.id}}" class="page-link">次へ</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
          </div>


        </div>
        <!-- サイドバー（右） -->
        <div class="col-4">
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
<script type="text/javascript" src="{% static 'js/main.js' %}"></script>
{% endblock %}